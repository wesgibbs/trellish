#!/usr/bin/env ruby

require 'trellish'
require 'trellish/card'
require 'yaml'

if ARGV[0].nil?
  Trellish.logger.error "Please provide a Trello card id or URL."
  exit
end

config_paths = %w(trellish.yml ~/trellish.yml ~/.trellish)
config_filepath = config_paths.collect { |e| File.expand_path(e) }.find { |e| File.exists?(e) }
config_file = YAML.load(File.read(config_filepath)) if config_filepath

unless config_file
  Trellish.logger.error "Could not locate your settings in ./trellish.yml, ~/trellish.yml, or ~/.trellish"
  exit
end

Trellish.configure(
  trello_api_key: config_file['trello_api_key'],
  trello_oauth_secret: config_file['trello_oauth_secret'],
  trello_oauth_token: config_file['trello_oauth_token'],
  github_oauth_token: config_file['github_oauth_token'],
  git_base_branch: config_file['git_base_branch'] || 'master',
  qa_list_name: config_file['qa_list_name'] || 'QA')

card = Trellish::Card.new(ARGV[0])
card.finish
